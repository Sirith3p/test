<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thyroid Quest — Prototype</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#38bdf8;--muted:#94a3b8}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
  body{background:linear-gradient(180deg,#071124 0%, #081627 60%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:24px}
  .app{width:100%;max-width:980px}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7dd3fc);display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263a}
  h1{font-size:20px;margin:0}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,.6)}
  .layout{display:grid;grid-template-columns:1fr 320px;gap:18px}
  .case-area{min-height:420px}
  .image-placeholder{height:220px;background:#061221;border:2px dashed #0b2540;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);margin-bottom:12px}
  .question{font-weight:600;margin-bottom:8px}
  .options{display:grid;gap:8px}
  .option{background:#071827;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.03);cursor:pointer}
  .option.correct{outline:3px solid rgba(56,189,248,.12);box-shadow:0 6px 18px rgba(56,189,248,.06)}
  .option.incorrect{opacity:.6}
  .meta{font-size:13px;color:var(--muted);margin-top:10px}
  .side{position:relative}
  .score{font-size:28px;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:12px;display:flex;gap:8px}
  button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#04263a;font-weight:600;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.04);color:var(--muted)}
  .progress{height:10px;background:#071827;border-radius:999px;overflow:hidden;margin-top:8px}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7dd3fc);width:0%}
  .explanation{background:#061421;padding:10px;border-radius:8px;margin-top:10px;font-size:14px}
  .editor{margin-top:12px}
  textarea{width:100%;min-height:80px;border-radius:8px;padding:8px;background:#04101a;border:1px solid rgba(255,255,255,.03);color:#cfe9ff}
  .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(125,211,252,.12);color:var(--accent);font-weight:700}
  @media (max-width:880px){.layout{grid-template-columns:1fr;}.side{order:2}}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">TQ</div>
    <div>
      <h1>Thyroid Quest — โปรโตไทป์การสอน Thyroid Pathology</h1>
      <div class="small">เล่นเป็นกรณีโรค ตรวจวินิจฉัย อ่านคำอธิบาย และสะสมคะแนน</div>
    </div>
  </header>

  <div class="card layout">
    <div class="case-area">
      <div class="image-placeholder" id="image">(ใส่ภาพชิ้นเนื้อ/H&E ที่นี่ — ลากแล้ววางไฟล์ภาพเพื่อทดสอบ)</div>
      <div class="question" id="caseTitle">Loading...</div>
      <div class="meta" id="caseMeta"></div>

      <div class="options" id="options"></div>

      <div class="explanation" id="explanation" style="display:none"></div>

      <footer>
        <button id="nextBtn" class="btn-ghost">ข้าม / ถัดไป</button>
        <button id="hintBtn">ขอ hint</button>
        <div style="flex:1"></div>
        <div class="small">ระดับ: <span id="level">Beginner</span></div>
      </footer>

      <div class="editor" id="editor">
        <div class="small">บรรณาธิการเคส (ใส่คำถามแบบ JSON ด้านล่าง เพื่อเพิ่มเคสชั่วคราว)</div>
        <textarea id="jsonInput">[{
  "title":"Case: 45-year-old woman with thyroid nodule",
  "meta":"H&E, core biopsy",
  "image":"",
  "choices":["Papillary thyroid carcinoma","Follicular adenoma","Hashimoto thyroiditis","Medullary carcinoma"],
  "answer":0,
  "explanation":"ลักษณะนิวเคลียร์ 'Orphan Annie' clearing, nuclear grooves และ psammoma bodies ชี้ไปที่ papillary carcinoma."
}]</textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="loadJson">โหลดเคสจาก JSON</button>
          <button id="resetBank" class="btn-ghost">รีเซ็ตเคส</button>
        </div>
      </div>
    </div>

    <aside class="side">
      <div class="card" style="padding:12px;margin-bottom:12px">
        <div>คะแนนรวม</div>
        <div class="score" id="score">0</div>
        <div class="small">เคสที่เล่น: <span id="played">0</span></div>
        <div class="progress" aria-hidden><i id="progBar"></i></div>
      </div>

      <div class="card" style="padding:12px;margin-bottom:12px">
        <div>เป้าหมายการเรียนรู้</div>
        <ul class="small">
          <li>รู้ลักษณะ H&E ของมะเร็งต่อมไทรอยด์หลัก</li>
          <li>เชื่อมอาการทางคลินิกกับภาพพยาธิ</li>
          <li>อ่านคำอธิบาย/biopsy report สั้นๆ</li>
        </ul>
      </div>

      <div class="card" style="padding:12px">
        <div>เหรียญความรู้</div>
        <div style="margin-top:8px"><span class="badge" id="badge">ไม่มี</span></div>
      </div>
    </aside>
  </div>
</div>

<script>
// Simple single-file game prototype
const defaultBank = [
  {title:"Case A: 45-year-old woman with solitary thyroid nodule",meta:"H&E core biopsy",image:'',
    choices:["Papillary thyroid carcinoma","Follicular adenoma","Hashimoto thyroiditis","Medullary carcinoma"],answer:0,
    explanation:"Nuclear clearing (Orphan Annie), nuclear grooves and psammoma bodies favour papillary carcinoma."},
  {title:"Case B: 60-year-old man with long-standing goiter",meta:"FNA smear",image:'',
    choices:["Follicular carcinoma","Graves disease","Subacute granulomatous thyroiditis","Anaplastic carcinoma"],answer:0,
    explanation:"Architectural microfollicular pattern + capsular/vascular invasion (on resection) indicate follicular carcinoma — FNA alone may be suspicious."},
  {title:"Case C: 38-year-old woman with hypothyroid symptoms",meta:"Core biopsy",image:'',
    choices:["Hashimoto thyroiditis","Riedel thyroiditis","Papillary carcinoma","Toxic multinodular goiter"],answer:0,
    explanation:"Lymphoid infiltrate with germinal centres and Hurthle cell change suggests Hashimoto thyroiditis."}
];
let bank = JSON.parse(JSON.stringify(defaultBank));
let state = {index:0,score:0,played:0};

const els = {caseTitle:el('caseTitle'),caseMeta:el('caseMeta'),options:el('options'),explanation:el('explanation'),score:el('score'),played:el('played'),progBar:el('progBar'),level:el('level'),badge:el('badge'),image:el('image')}

function el(id){return document.getElementById(id)}
function render(){
  const c = bank[state.index];
  if(!c){els.caseTitle.textContent='ไม่มีเคสแล้ว — โหลดเคสใหม่';els.options.innerHTML='';els.caseMeta.textContent='';return}
  els.caseTitle.textContent=c.title;els.caseMeta.textContent=c.meta;
  els.options.innerHTML='';els.explanation.style.display='none';
  c.choices.forEach((opt,i)=>{
    const d=document.createElement('div');d.className='option';d.textContent=opt;d.addEventListener('click',()=>choose(i,d));els.options.appendChild(d);
  });
  els.score.textContent=state.score;els.played.textContent=state.played;els.progBar.style.width = (state.played / Math.max(1,bank.length) * 100) + '%';
  els.level.textContent = state.score >= bank.length*0.8 ? 'Advanced' : state.score >= bank.length*0.4 ? 'Intermediate' : 'Beginner';
}
function choose(i,dom){
  const c = bank[state.index];
  const correct = i===c.answer;
  Array.from(els.options.children).forEach((node,idx)=>{
    node.classList.add(idx===c.answer? 'correct':'incorrect');
    node.style.pointerEvents='none';
  });
  dom.classList.add(correct? 'correct':'incorrect');
  if(correct){state.score += 10; els.badge.textContent = state.score>=30? 'Pathologist-in-training' : 'Learner';}
  state.played += 1;
  els.explanation.style.display='block';els.explanation.textContent = c.explanation;
}

el('nextBtn').addEventListener('click',()=>{
  state.index = (state.index + 1) % bank.length; render();
});
el('hintBtn').addEventListener('click',()=>{
  const c = bank[state.index];
  alert('HINT: คำใบ้ — คิดถึงลักษณะนิวเคลียร์และลักษณะเฉพาะของโรค');
});

el('loadJson').addEventListener('click',()=>{
  try{const parsed = JSON.parse(el('jsonInput').value); if(!Array.isArray(parsed)) throw 'JSON ต้องเป็น array ของเคส'; bank = parsed; state.index=0; state.score=0; state.played=0; render(); alert('โหลดเคสเรียบร้อย — ตรวจสอบรูปภาพถ้ามี (ลิงก์หรือ base64)');}catch(e){alert('เกิดข้อผิดพลาดในการแปลง JSON: '+e)}
});
el('resetBank').addEventListener('click',()=>{bank = JSON.parse(JSON.stringify(defaultBank)); state.index=0; state.score=0; state.played=0; render();});

// Drag & drop image support for placeholder
els.image.addEventListener('dragover', e=>{e.preventDefault();els.image.style.opacity=0.9});
els.image.addEventListener('dragleave', e=>{els.image.style.opacity=1});
els.image.addEventListener('drop', e=>{
  e.preventDefault();els.image.style.opacity=1;const file = e.dataTransfer.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = ev=>{els.image.innerHTML = '<img src="'+ev.target.result+'" style="max-width:100%;border-radius:6px;">';}; reader.readAsDataURL(file);
});

// Initial render
render();
</script>
</body>
</html>
